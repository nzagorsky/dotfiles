#!/usr/bin/env bash

# TODO check if yay exists to avoid errors
identify_os () {
    . /etc/os-release
    echo $NAME | tr '[:upper:]' '[:lower:]'
}

setup_yay () {
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si
}

install_yay_packages() {
    yay -S --needed --noconfirm megasync
    yay -S --needed --noconfirm consolas-font
    yay -S --needed --noconfirm polybar
}

install_bspwm_arch() {
    sudo pacman -S --needed --noconfirm bspwm
    sudo pacman -S --needed --noconfirm picom
    sudo pacman -S --needed --noconfirm kupfer
    sudo pacman -S --needed --noconfirm neofetch
    sudo pacman -S --needed --noconfirm nitrogen
    sudo pacman -S --needed --noconfirm sxhkd
    sudo pacman -S --needed --noconfirm kitty
    sudo pacman -S --needed --noconfirm xorg
    sudo pacman -S --needed --noconfirm xorg-xinit
    sudo pacman -S --needed --noconfirm thunar
    sudo pacman -S --needed --noconfirm xsecurelock

    # Fonts
    # https://wiki.archlinux.org/index.php/Fonts
    sudo pacman -S --needed --noconfirm gnu-free-fonts
    sudo pacman -S --needed --noconfirm noto-fonts
    sudo pacman -S --needed --noconfirm noto-fonts-emoji
    sudo pacman -S --needed --noconfirm noto-fonts-extra
    sudo pacman -S --needed --noconfirm ttf-liberation  # Mono fonts in browsers
    sudo pacman -S --needed --noconfirm ttf-roboto
    sudo pacman -S --needed --noconfirm ttf-roboto-mono

}

install_base_desktop_arch () {
    sudo pacman -S --needed --noconfirm docker
    sudo pacman -S --needed --noconfirm openvpn
    sudo pacman -S --needed --noconfirm playerctl

    sudo pacman -S --needed --noconfirm ttf-hack  # Terminal
    sudo pacman -S --needed --noconfirm xfce4-terminal
    sudo pacman -S --needed --noconfirm xclip  # neovim shared copy/paste buffer

    # Sound and A2DP
    sudo pacman -S --needed --noconfirm pulseaudio-bluetooth
    sudo pacman -S --needed --noconfirm pavucontrol
}

install_desktop_debian () {
    sudo apt-get update
    sudo apt-get install -y flatpak
    sudo apt-get install -y openvpn
    sudo apt-get install -y docker.io
    sudo apt-get install -y xclip
    sudo apt-get install -y xfce4-terminal
}

configure_gnome () {
    sudo pacman -S --needed --noconfirm chrome-gnome-shell
    dconf load  / < optional/dconf.conf
    gsettings set org.gnome.shell.app-switcher current-workspace-only true

    gsettings set org.gnome.desktop.peripherals.keyboard repeat-interval 50
    gsettings set org.gnome.desktop.peripherals.keyboard delay 250
}

configure_kde () {
    sudo pacman -S --needed --noconfirm kdeconnect
}

install_flatpak_apps () {
    # Flatpak packages
    flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
    flatpak install flathub --user -y \
        fondo \
        io.dbeaver.DBeaverCommunity
}


main () {
    install_base_desktop_arch

    if [ "$XDG_SESSION_DESKTOP" == "KDE" ]; then
        echo "Detected KDE"
        configure_kde

    elif [ "$XDG_SESSION_DESKTOP" == "gnome" ]; then
        echo "Detected Gnome"
        configure_gnome

    else
        echo "Did not detect session. Check XDG_SESSION_DESKTOP variable. Current value is $XDG_SESSION_DESKTOP"

    fi

}

main
