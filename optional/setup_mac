#!/usr/bin/env bash
set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
BOLD='\033[1m'
NC='\033[0m'

cat ~/.config/zsh/.zshrc | grep PATH >/tmp/dotenv && source /tmp/dotenv

install_neovim_plugins() {
	nvim --headless "+Lazy! sync" +qa
	echo -e "${GREEN}neovim install success${NC}"
}

install_npm_deps() {
	npm install -g --quiet --silent @ansible/ansible-language-server >/dev/null 2>&1
	npm install -g --quiet --silent \
		neovim \
		sql-formatter \
		bash-language-server \
		dockerfile-language-server-nodejs \
		javascript-typescript-langserver \
		marked \
		prettier \
		pyright \
		standard >/dev/null 2>&1 &&
		echo -e "${GREEN}npm install success${NC}"
}

install_python_deps() {
	pip3 install -q -U --user \
		"python-language-server[all]" \
		"ansible-lint" \
		ansible \
		awscli \
		hcloud \
		cytoolz \
		black \
		isort \
		dataset \
		dateparser \
		django-stubs \
		django \
		ipdb \
		ipython \
		neovim \
		pipenv \
		python-dateutil \
		httpx \
		youtube-dl \
		yamllint \
		--no-warn-script-location &&
		echo -e "${GREEN}pip install success${NC}"
}

install_brew_packages() {
	brew tap homebrew/cask-fonts
	brew tap hashicorp/tap

	brew install --quiet --cask font-hack-nerd-font
	brew install --quiet --cask another-redis-desktop-manager --no-quarantine

	brew install --quiet \
		hashicorp/tap/vault \
		datawire/blackbird/telepresence-arm64 \
		autoconf \
		marksman \
		automake \
		bat \
		curl \
		exa \
		fd \
		fzy \
		hammerspoon \
		go \
		rust \
		rust-analyzer \
		yq \
		gitui \
		helm \
		htop \
		iina \
		jq \
		krew \
		kubectl \
		libxmlsec1 \
		llvm \
		m-cli \
		mosh \
		mysql \
		navi \
		ncdu \
		neovim \
		rectangle \
		node \
		nushell \
		openvpn \
		postgresql@14 \
		python3 \
		rclone \
		ripgrep \
		shfmt \
		sqlite3 \
		terraform-ls \
		tfenv \
		tmux \
		universal-ctags \
		watch \
		wget \
		wireguard-tools \
		zsh-syntax-highlighting &&
		echo -e "${GREEN}Brew install success${NC}"

}

install_go_packages() {
	# Restart on file change
	# Example: reflex -s -v -- zsh -c 'go run . & reloadtab'
	go install github.com/cespare/reflex@latest

}

install_extras() {
	ansible-galaxy collection install kubernetes.core >/dev/null 2>&1
	kubectl krew install modify-secret >/dev/null 2>&1
}

main() {
	install_brew_packages

	install_go_packages
	install_npm_deps
	install_python_deps
	install_neovim_plugins
	install_extras
}

main
